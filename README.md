# Balance Web Application

Простое веб-приложение для обновления баланса пользователя с обработкой конкурентных запросов.

## Технологии

- Node.js
- Express
- PostgreSQL
- Sequelize ORM
- Umzug (для миграций)

## Структура проекта

```
src/
  ├── config/        # Конфигурация приложения
  ├── controllers/   # Контроллеры
  ├── middlewares/   # Middleware компоненты
  ├── migrations/    # Миграции базы данных
  ├── models/        # Модели данных
  ├── routes/        # Маршруты API
  ├── services/      # Бизнес-логика
  ├── utils/         # Вспомогательные функции
  ├── validators/    # Валидаторы
  └── app.js         # Точка входа в приложение
```

## Установка и запуск

1. Клонируйте репозиторий
```bash
git clone https://github.com/yourusername/balance-webapp.git
cd balance-webapp
```

2. Установите зависимости
```bash
npm install
```

3. Создайте файл .env с параметрами подключения к базе данных
```
DATABASE_URL=postgres://username:password@localhost:5432/balance_db
PORT=3000
```

4. Запустите миграции
```bash
npm run migrate
```

5. Запустите приложение
```bash
npm start
```

## API

### Обновление баланса пользователя

`POST /api/users/update-balance`

Тело запроса:
```json
{
  "userId": 1,
  "amount": 100.50
}
```

Параметры:
- `userId` - ID пользователя (целое число)
- `amount` - Сумма изменения баланса (положительное число для пополнения, отрицательное для списания)

Успешный ответ:
```json
{
  "success": true,
  "balance": 10100.50,
  "userId": 1
}
```

Ответ при недостаточном балансе:
```json
{
  "success": false,
  "error": "Insufficient funds"
}
```

## Особенности реализации

- Атомарное обновление баланса с помощью SQL для корректной обработки конкурентных запросов
- Строгая валидация входных данных
- Обработка ошибок с соответствующими HTTP-кодами
- Логирование операций с балансом

## Тестирование

Приложение успешно проходит тест с 10000 конкурентными запросами на списание средств, где 5000 запросов выполняются успешно, а другие 5000 получают ошибку о недостаточном балансе.